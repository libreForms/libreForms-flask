{% extends 'base.html' %}
{% block content %}
			{% if context %}
			<form method="post" autocomplete="off">
				<fieldset>
					{% if options._description %}<label>{{ options._description }}</label><hr>{% endif %}
					{% for field in context.keys() %}

					{# here we assign a local variable called 'content' which either pulls a list of users or the regular field content #}
					{% if context[field].input_field.lookup == "user_list" %}
					{% set content = user_list %}
					{% else %}
					{% set content = context[field].input_field.content %}
					{% endif %}

					{% if editing_existing_form and context[field]['input_field']['type'] == 'hidden' and context[field]['_make_visible_in_edits'] and context[field]['_secondary_input_type'] %}
						{% set input_type = context[field]['_secondary_input_type'] %}
					{% else %}
						{% set input_type = context[field]['input_field']['type'] %}
					{% endif %}

					{# here we override the default value with overrides if default_overrides was passed #}
					{% if default_overrides and field in default_overrides %}
						{% set default_value = default_overrides[field] %}
					{% else %}
						{% if context['_suppress_default_values'] == true or context[field].input_field.type in ['checkbox', 'radio', 'autocomplete'] %}
							{% set default_value = '' %}
						{% else %}
							{% set default_value = context[field].input_field.content[0] %}
						{% endif %}
					{% endif %}

					{% if input_type == "autocomplete" %}

					<div class="form-group autocomplete{% if context[field]['_depends_on'] %} {{ context[field]['_depends_on'][0] }}{% endif %}">
						<label class="form-label mt-4{% if context[field].output_data.required==true %} required{% endif %}" for="{{ field }}" {% if context[field].output_data.description %}data-bs-toggle="tooltip" data-bs-placement="right" title="{{context[field].output_data.description}}"{% endif %}>{{ field | replace('_', ' ')}}</label>
						<input class="form-control" type="text" value="{{default_value}}" id="{{ field }}" name="{{ field }}" {% if context[field].output_data.required==true %}required{% endif %}/>
					</div>

					<script>
						/*An array containing all values passed for this field:*/
						var {{ field }} = {{ content | safe }};
						autocomplete(document.getElementById("{{ field }}"), {{ field }});
					</script>
				
					{% elif input_type == "select" %}
					<div class="form-group{% if context[field]['_depends_on'] %} {{ context[field]['_depends_on'][0] }}{% endif %}">
						<label class="form-label mt-4{% if context[field].output_data.required==true %} required{% endif %}" for="{{ field }}" {% if context[field].output_data.description %}data-bs-toggle="tooltip" data-bs-placement="right" title="{{context[field].output_data.description}}"{% endif %}>{{ field | replace('_', ' ')}}</label>
						<select name="{{ field }}" class="form-select" {% if context[field].output_data.required==true %}required{% endif %}>
						{% for item in content %}
								<option value="{{ item }}" id="{{ field }} {{ item }}" name="{{ field }}" {%if item == default_value%}selected="selected"{%endif%}>{{ item }}</option>
						{% endfor %}
						</select>
					</div>
					{% elif input_type == "radio" %}
					<div class="form-group{% if context[field]['_depends_on'] %} {{ context[field]['_depends_on'][0] }}{% endif %}">
						<label class="form-label mt-4{% if context[field].output_data.required==true %} required{% endif %}" for="" {% if context[field].output_data.description %}data-bs-toggle="tooltip" data-bs-placement="right" title="{{context[field].output_data.description}}"{% endif %}>{{ field | replace('_', ' ')}}</label>
						{% for item in content %}
						<div class="form-check">
							<label class='form-check-label' for="{{ field }} {{ item }}">{{ item }}
								<input class="form-check-input" style="{{'border: 1px solid;' if not dark_mode else ''}}" type="radio" value="{{ item }}" id="{{ field }} {{ item }}" name="{{ field }}"  {%if item == default_value%}checked="checked"{%endif%}/>
							</label>
						</div>
						{% endfor %}
					</div>
					{% elif input_type == "checkbox" %}
					<div class="form-group{% if context[field]['_depends_on'] %} {{ context[field]['_depends_on'][0] }}{% endif %}">
						<label class="form-label mt-4{% if context[field].output_data.required==true %} required{% endif %}" for="" {% if context[field].output_data.description %}data-bs-toggle="tooltip" data-bs-placement="right" title="{{context[field].output_data.description}}"{% endif %}>{{ field | replace('_', ' ')}}</label>
						{% for item in content %}
						<div class="form-check">
							<label class='form-check-label' for="{{ field }} {{ item }}">{{ item }}
								<input class="form-check-input" style="{{'border: 1px solid;' if not dark_mode else ''}}" type="checkbox" value="{{ item }}" id="{{ field }} {{ item }}" name="{{ field }}"  {%if item in default_value%}checked="checked"{%endif%}/>
							</label>
						</div>
						{% endfor %}
					</div>
					{% elif input_type == "hidden" %}
					<div class="form-group{% if context[field]['_depends_on'] %} {{ context[field]['_depends_on'][0] }}{% endif %}">
						<input class="form-control" type="hidden" value="{{ default_value }}" id="{{ field }}" name="{{ field }}"/>
					</div>

					{% elif input_type == "immutable_user_field" %}
					<div class="form-group{% if context[field]['_depends_on'] %} {{ context[field]['_depends_on'][0] }}{% endif %}">
						<label class="form-label mt-4{% if context[field].output_data.required==true %} required{% endif %}" for="{{ field }}" {% if context[field].output_data.description %}data-bs-toggle="tooltip" data-bs-placement="right" title="{{context[field].output_data.description}}"{% endif %}>{{ field | replace('_', ' ')}}</label></td>
						<input class="form-control" type="text" value="{{ current_user|attr(default_value) if current_user else '' }}" id="{{ field }}" name="{{ field }}" disabled=""/>
					</div>

					{% else %}
					<div class="form-group{% if context[field]['_depends_on'] %} {{ context[field]['_depends_on'][0] }}{% endif %}">
						<label class="form-label mt-4{% if context[field].output_data.required==true %} required{% endif %}" for="{{ field }}" {% if context[field].output_data.description %}data-bs-toggle="tooltip" data-bs-placement="right" title="{{context[field].output_data.description}}"{% endif %}>{{ field | replace('_', ' ')}}</label></td>
						<input class="form-control" type="{{ input_type }}" value="{{ default_value }}" id="{{ field }}" name="{{ field }}"/>
					</div>
	
					{% endif %}
					{% endfor %}
					
					{% if options._presubmit_msg %}<hr/><label>{{ options._presubmit_msg }}</label>{% endif %}

					{% if require_password %}

					<div class="form-group">
						<label class="form-label mt-4 required" for="_password" data-bs-toggle="tooltip" data-bs-placement="right" title="Please re-enter your password to digitally sign this document">Password</label></td>
						<input class="form-control" type="password" value="" id="_password" name="_password"/>
					</div>	
					{% endif %}

					<div class="form-group">
						<input class="btn btn-primary mt-4" type=submit value="Submit">
					</div>

				</fieldset>

				
			</form>
			{% endif %}


			{% if filename %}
			<br/>
			<table>
			  <tr><td>
				<a href="{{ url_for(type+'.download_file', filename = filename, signature=signed_url) }}">download a CSV template of this form</a>
				<sup><span data-bs-toggle="tooltip" data-bs-placement="right" title="Click me for help"><button class="btn btn-link btn-sm" type="button" data-bs-toggle="offcanvas" data-bs-target="#templateHelp" aria-controls="templateHelp">(?)</button></span></sup>
			</td></tr>
			</table>
		  
		    {% endif %}

		
			{% if homepage %}
			  {{ config.homepage_msg }}
		    {% endif %}
		    {% if msg %}
			  {{ msg }}
		    {% endif %}
		    {% if form_not_found %}
			    <p>Go <a href="{{ url_for( 'home' ) }}">home</a>.</p>
		    {% endif %}

{% endblock %}


{% block addons %}

<div class="offcanvas offcanvas-bottom"  style="z-index:999998 !important;" tabindex="-1" id="templateHelp" aria-labelledby="templateHelpLabel">
	<div class="offcanvas-header">
		<h5 class="offcanvas-title" id="templateHelpLabel">Using CSV Templates</h5>
		<button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
	</div>
	<div class="offcanvas-body">
		<div>
			<p>By clicking this link, your browser should download a CSV file with columns names corresponding to the fields in this form.</p>
			<p>You can populate multiple rows of this CSV, each row corresponding to a different, unique submission of this form.</p>
		</div>
	</div>
</div>

{% endblock %}