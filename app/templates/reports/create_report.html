{% extends 'base.html' %}
{% block content %}
 
<form method="post">
  <fieldset>
    <div class="form-group">
      <label class="form-label mt-4 required" for="name" data-bs-toggle="tooltip" data-bs-placement="right" title="Enter a name for the new report (100 chars max)">Name</label>
      <input class="form-control" type="text" id="name" name="name" value="{{ report.name if report else ''}}" maxlength="100" required/>
    </div>
    
    <!-- <div class="form-group">
      <label class="form-label mt-4 required" for="form_name" data-bs-toggle="tooltip" data-bs-placement="right" title="Select the form for which you'd like to generate a report">Frequency</label>
      <select id="form_name" name="form_name">
        {% for form in forms %}
        <option value="{{ form }}">{ form }}</option>
        {% endfor %}
      </select>
    </div> -->

    <div class="form-group">
      <label class="form-label mt-4 required" for="filters" data-bs-toggle="tooltip" data-bs-placement="right" title="Enter any filters you want to apply (300 chars max)">Filters</label><span data-bs-toggle="tooltip" data-bs-placement="right" title="Click me for help"><button class="btn btn-link btn-sm" type="button" data-bs-toggle="offcanvas" data-bs-target="#filterHelp" aria-controls="filterHelp">(?)</button></span>
      <textarea class="form-control" rows="3" id="filters" name="filters" maxlength="300" onchange = "validateFilter(this.form.filters.value);" onkeypress = "this.onchange();" onpaste = "this.onchange();" oninput = "this.onchange();" required>{{ report.filters if report else ''}}</textarea>
    </div>

    <div class="form-group">
      <label class="form-label mt-4 required" for="frequency" data-bs-toggle="tooltip" data-bs-placement="right" title="Select the frequency you'd like to receive the report at">Frequency</label>
      <select class="form-control" id="frequency" name="frequency" required>
        <option value="hourly"{%if report and report.frequency == 'hourly'%} selected="selected"{%endif%}>Hourly</option>
        <option value="daily"{%if report and report.frequency == 'daily'%} selected="selected"{%endif%}>Daily</option>
        <option value="weekly"{%if report and report.frequency == 'weekly'%} selected="selected"{%endif%}>Weekly</option>
        <option value="monthly"{%if report and report.frequency == 'monthly'%} selected="selected"{%endif%}>Monthly</option>
        <option value="annually"{%if report and report.frequency == 'annually'%} selected="selected"{%endif%}>Annually</option>
      </select>
    </div>
    
    <div class="form-group">
      <label class="form-label mt-4" for="start_at" data-bs-toggle="tooltip" data-bs-placement="right" title="Select the starting date (defaults to today)">Start Date</label>
      <input class="form-control" type="date" id="start_at" name="start_at" value="{{ report.start_at_human_readable if report else ''}}"/>
    </div>

    <div class="form-group">
      <label class="form-label mt-4" for="end_at" data-bs-toggle="tooltip" data-bs-placement="right" title="Select the ending date (defaults to never)">End Date</label>
      <input class="form-control" type="date" id="end_at" name="end_at" value="{{ report.end_at_human_readable if report else ''}}"/> 
    </div>

    <div class="form-group mt-4">
      <input type="submit" value="Submit" class="btn btn-primary" />    
    </div>
  </fieldset>
</form> 


{% if msg %}

  {{ msg }}

{% endif %}    

{% endblock %}


{% block addons %}

<div class="offcanvas offcanvas-bottom"  style="z-index:999998 !important;" tabindex="-1" id="filterHelp" aria-labelledby="filterHelpLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="filterHelpLabel">Using Report Filters</h5>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <div>
      <p>Report filters are used to filter results that will be captured by each report, using comma-separated conditions. These conditions should employ standard Python operators, see https://www.w3schools.com/python/python_operators.asp.</p>
      <h6>Examples</h6>
      <ul>
        <li><code>Team_Name in ['Budget', 'Marketing'],</code></li>
        <li><code>Proposed_Cost > 1000000,</code></li>
        <li><code>Owner = 'john.smith',</code></li>
      </ul>
    </div>
  </div>
</div>

{% endblock %}
